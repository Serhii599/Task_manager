{% extends "base.html" %}
{% block title %}Users{% endblock %}

{% block content %}

<div>

    <h2 style="margin-bottom: 20px">Users</h2>

    <table>
        <thead>
        <tr>
            <th>First name</th>
            <th>Last name</th>
            <th>Tasks</th>
        </tr>
        </thead>

        <tbody>
        {% for user in users %}
            <tr class="task-row"
                data-href="{% url 'main_app:users_tasks' user.id %}">
                <td>{{ user.first_name }}</td>
                <td>{{ user.last_name }}</td>
                <td class="center">
                    <button class="button-main">View tasks</button>
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="3" style="text-align:center;">No users found</td></tr>
        {% endfor %}
        </tbody>
    </table>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".task-row").forEach(row => {
        row.addEventListener("click", function(event) {

            // Щоб кліки по кнопці не дублювалися
            if (event.target.tagName.toLowerCase() === 'button') return;

            window.location = row.dataset.href;
        });
    });

    // Кнопка View tasks теж переходить
    document.querySelectorAll(".button-main").forEach(btn => {
        btn.addEventListener("click", function(event) {
            const row = event.target.closest(".task-row");
            window.location = row.dataset.href;
        });
    });
});
</script>

{% endblock %}
