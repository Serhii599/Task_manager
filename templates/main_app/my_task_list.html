{% extends "base.html" %}
{% block title %}My tasks table{% endblock %}
{% block content %}
            <div class="filters-box">
                <form method="get" id="filtersForm">
                    <select name="status" onchange="document.getElementById('filtersForm').submit()">
                        <option value="">All statuses</option>
                        <option value="Backlog"  {% if request.GET.status == "Backlog" %}selected{% endif %}>Backlog</option>
                        <option value="In Progress" {% if request.GET.status == "In Progress" %}selected{% endif %}>In Progress</option>
                        <option value="Done" {% if request.GET.status == "Done" %}selected{% endif %}>Done</option>
                    </select>
                    <select name="priority" onchange="document.getElementById('filtersForm').submit()">
                        <option value="">All priorities</option>
                        <option value="Low" {% if request.GET.priority == "Low" %}selected{% endif %}>Low</option>
                        <option value="Medium" {% if request.GET.priority == "Medium" %}selected{% endif %}>Medium</option>
                        <option value="High" {% if request.GET.priority == "High" %}selected{% endif %}>High</option>
                        <option value="Urgent" {% if request.GET.priority == "Urgent" %}selected{% endif %}>Urgent</option>
                    </select>
                </form>
            </div>
        <table>
            <thead>
            <tr>
                <th><a href="?sort=task_name{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Name
                </a></th>
                <th><a href="?sort=assignee{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Assignee
                </a></th>
                <th><a href="?sort=description{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Description
                </a></th>
                <th><a href="?sort=status{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Status
                </a></th>
                <th><a href="?sort=priority{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Priority
                </a></th>
                <th><a href="?sort=project{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                    Project
                </a></th>
                <th>
                    <a href="?sort=due_date{% if request.GET.status %}&status={{ request.GET.status }}{% endif %}{% if request.GET.priority %}&priority={{ request.GET.priority }}{% endif %}">
                        Due date
                    </a>
                </th>
                <th>Delete</th>
            </tr>
            </thead>
            <tbody>
            {% for task in tasks %}
            <tr class="task-row" data-href="{% url 'main_app:one_task' task.id %}">
                <td>{{ task.task_name }}</td>
                <td>{{ task.assignee.first_name }}</td>
                <td>{{ task.task_description }}</td>
                <td>{{ task.status }}</td>
                <td>{{ task.priority }}</td>
                {% for project in task.projects.all %}
                    <td>{{ project.project_name }}</td>
                {% empty %}
                    <td></td>
                {% endfor %}
                <td>{{ task.due_date }}</td>
                <td class="center-button">
                    <form  method="post" action="{% url 'main_app:task_delete' task.id %}">
                    {% csrf_token %}
                    <button type="submit" class="button-24">X</button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>

<script>
document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll(".task-row").forEach(row => {
        row.addEventListener("click", () => {
            window.location = row.dataset.href;
        });
    });
});
</script>
{% endblock %}